import{j as a,a as e,L as I,r as m,F as b,u as C,d as w}from"./app.944e8d8e.js";import{F as D,U as T}from"./index.es.bbd55343.js";import{d as y,c as F}from"./date.helpers.37179c42.js";import{m as N}from"./maplibre-gl.11b67a0a.js";import{p as j}from"./general.helpers.0a3fe5e5.js";import{A as L}from"./AppLayout.595fb028.js";import{A as _}from"./AircraftCondition.8b13e728.js";import"./FlashMessage.f8f9d883.js";const s=t=>a("div",{className:"rounded shadow bg-white p-4 mr-2 text-center",children:[t.link?e("div",{className:"text-2xl",children:e(I,{href:t.link,className:"ml-2 btn",children:t.stat})}):e("div",{className:"text-2xl",children:t.stat}),e("div",{className:"text-sm",children:t.title})]}),Y="pk.eyJ1IjoicnVzc2VsbHd3ZXN0IiwiYSI6ImNrc29vZm5paDEweGIzMnA3MXAzYTFuMDQifQ.7veU-ARmzYClHDFsVQvT5g",E=t=>{const i=m.exports.useRef(null),r=m.exports.useRef(null),[o,f]=m.exports.useState({});return m.exports.useEffect(()=>{r.current||(r.current=new N.Map({container:i.current,style:j(t.mapStyle),center:[t.aircraft.last_lon,t.aircraft.last_lat],zoom:14,accessToken:Y}))}),m.exports.useEffect(()=>{if(t.aircraft){f(t.aircraft);const d=[t.aircraft.last_lon,t.aircraft.last_lat];r.current.on("load",function(){new N.Marker({color:"#F97316"}).setLngLat(d).addTo(r.current)})}},[t.aircraft]),e(b,{children:e("div",{ref:i,className:"map-container-"+t.size})})},z=({aircraft:t,maintenanceStatus:i,pireps:r})=>{const{auth:o}=C().props,f=n=>n.reduce((l,h)=>l+h.distance,0),d=()=>t.owner_id>0?t.owner_id===o.user.id:o.user.user_roles.includes("fleet_manager"),g=n=>{switch(n){case 1:return"Engine 100 hour";case 2:return"Engine TBO";case 3:return"Annual airframe inspection";case 4:return"General Maintenance";case 5:return"Engine Maintenance"}},u=n=>{if(n.owner_id===o.user.id||n.location.is_hub||n.location.size>=3)return!0},A=(n,l)=>{if(!u(n)){window.alert("Maintenance is not available at this airport");return}let c=0;switch(n.fleet.size){case"S":c=15e3;break;case"M":c=3e4;break;case"L":c=6e4;break}if(!window.confirm(`TBO will cost $${c}, do you want to proceed?`))return;const v={aircraft:n.id,engine:l,type:2,cat:"Inspection"};w.Inertia.post("/aircraft/maintenance",v)},M=(n,l)=>{if(!u(n)){window.alert("Maintenance is not available at this airport");return}if(!window.confirm("100 hour check will cost $2000.00, do you want to proceed?"))return;const p={aircraft:n.id,engine:l,type:1,cat:"Inspection"};w.Inertia.post("/aircraft/maintenance",p)},k=n=>{if(!u(n)){window.alert("Maintenance is not available at this airport");return}if(!window.confirm("Annual airframe check will cost $2000.00, do you want to proceed?"))return;const c={aircraft:n.id,type:3,cat:"Inspection"};w.Inertia.post("/aircraft/maintenance",c)},x=(n,l,h=null)=>{if(!u(n)){window.alert("Maintenance is not available at this airport");return}if(!window.confirm(`Are you sure you want to proceed with ${l===4?"General":"Engine"} maintenance?`))return;const v={aircraft:n.id,engine:h,type:l,cat:"General"};w.Inertia.post("/aircraft/maintenance",v)};return a("div",{className:"p-4",children:[a("div",{className:"flex justify-start items-center",children:[e("h1",{children:`${t.registration} - ${t.fleet.manufacturer} ${t.fleet.name} (${t.fleet.type})`}),t.maintenance_status&&!t.is_rental&&e("span",{className:"ml-2 text-orange-500",children:e(D,{icon:T})}),t.is_rental?e("span",{className:"ml-2 bg-orange-500 text-white p-1 rounded text-xs",children:"Rental"}):e(b,{}),t.owner_id>0&&t.owner_id===o.user.id?e("span",{className:"ml-2 bg-orange-500 text-white p-1 rounded text-xs",children:"Private Plane - Owner"}):t.owner_id>0?e("span",{className:"ml-2 bg-orange-500 text-white p-1 rounded text-xs",children:"Private Plane"}):e(b,{})]}),i["100hr"]||i.annual||i.tbo?a("div",{className:"text-red-400",children:[e("p",{children:"Maintenance Required:"}),a("ul",{children:[i.annual&&e("li",{children:"Airframe Annual Inspection"}),i["100hr"]&&e("li",{children:"100 Hour Inspection"}),i.tbo&&e("li",{children:"Engine Overhaul"})]})]}):e(b,{}),a("div",{className:"flex flex-col md:flex-row justify-between",children:[e("div",{className:"md:w-1/5 my-1",children:e(s,{title:"Flights",stat:r.length})}),e("div",{className:"md:w-1/5 my-1",children:e(s,{title:"Distance Flown",stat:f(r)})}),e("div",{className:"md:w-1/5 my-1",children:e(s,{title:"Current Location",stat:t.current_airport_id,link:"/airports/"+t.current_airport_id})}),e("div",{className:"md:w-1/5 my-1",children:e(s,{title:"Home Hub",stat:t.hub_id,link:"/airports/"+t.hub_id})}),e("div",{className:"md:w-1/5 my-1",children:e(s,{title:"Current Fuel",stat:t.fuel_onboard})})]}),a("div",{className:"flex flex-col md:flex-row md:justify-between mt-4",children:[a("div",{className:"md:w-1/2 mx-2",children:[a("div",{className:"flex flex-col md:flex-row justify-between",children:[e("div",{className:"md:w-1/3 my-1",children:e(s,{title:"Airframe Time",stat:(t.flight_time_mins/60).toFixed(2)})}),e("div",{className:"md:w-1/3 my-1",children:e(s,{title:"Last Inspection (Annual)",stat:y(t.last_inspected_at).format("DD/MM/YYYY")})}),e("div",{className:"md:w-1/3 my-1",children:e(s,{title:"TBO Interval",stat:t.fleet.tbo_mins/60})})]}),!t.is_rental&&a("div",{className:"bg-white p-4 rounded shadow overflow-x-auto my-2",children:[a("div",{className:"flex justify-between",children:[e("div",{className:"text-lg mb-2",children:"Maintenance"}),d()&&a("div",{className:"flex justify-between space-x-1",children:[e("button",{className:"btn btn-secondary btn-small my-1",onClick:()=>x(t,4),children:"General Maintenance"}),e("button",{className:"btn btn-secondary my-1 btn-small",onClick:()=>k(t),children:"Annual Inspection"})]})]}),a("div",{className:"mt-2 my-4",children:[e("div",{children:"Airframe Condition"}),e(_,{aircraftCondition:t.wear})]}),a("table",{className:"table table-auto table-condensed",children:[e("thead",{children:a("tr",{children:[e("th",{children:"Engine #"}),e("th",{children:"Time since 100 hr"}),e("th",{children:"Time since TBO"}),e("th",{children:"Condition"}),d()&&e("th",{children:"Action"})]})}),e("tbody",{children:t.engines.map(n=>a("tr",{children:[e("td",{children:n.engine_no}),a("td",{children:[(n.mins_since_100hr/60).toFixed(2),d()&&e("button",{className:"btn btn-secondary ml-2 btn-small",onClick:()=>M(t,n.id),children:"100 hr"})]}),a("td",{children:[(n.mins_since_tbo/60).toFixed(2),d()&&e("button",{className:"btn btn-secondary ml-2 btn-small",onClick:()=>A(t,n.id),children:"TBO"})]}),e("td",{children:e(_,{aircraftCondition:n.wear})}),d()&&e("td",{children:e("button",{onClick:()=>x(t,5,n.id),className:"btn btn-secondary btn-small",children:"Engine Maintenance"})})]},n.id))})]})]}),!t.is_rental&&a("div",{className:"bg-white p-4 rounded shadow overflow-x-auto",children:[e("div",{className:"text-lg mb-2",children:"Maintenance Logs"}),a("table",{className:"table table-auto table-condensed",children:[e("thead",{children:a("tr",{children:[e("th",{children:"Type"}),e("th",{children:"Cost"}),e("th",{children:"Date"})]})}),e("tbody",{children:t.maintenance.map(n=>a("tr",{children:[e("td",{children:g(n.maintenance_type)}),e("td",{children:n.cost}),e("td",{children:y(n.created_at).format("DD/MM/YYYY")})]},n.id))})]})]}),a("div",{className:"bg-white p-4 rounded shadow overflow-x-auto mt-2",children:[e("div",{className:"text-lg mb-2",children:"Flights"}),a("table",{className:"table table-auto table-condensed",children:[e("thead",{children:a("tr",{children:[e("th",{children:"Date"}),e("th",{children:"Departure"}),e("th",{children:"Arrival"}),e("th",{children:"Distance"}),e("th",{children:"Time"})]})}),e("tbody",{children:r&&r.map(n=>a("tr",{children:[e("td",{children:n.submitted_at}),e("td",{children:n.departure_airport_id}),e("td",{children:n.destination_airport_id}),e("td",{children:n.distance}),e("td",{children:F(n.flight_time)})]},n.id))})]})]})]}),e("div",{className:"md:w-1/2 mx-1",children:e("div",{className:"bg-white p-4 rounded shadow overflow-x-auto",children:e(E,{aircraft:t,size:"large",mapStyle:o.user.map_style})})})]})]})};z.layout=t=>e(L,{children:t,title:"Aircraft Details",heading:"Aircraft Details"});export{z as default};

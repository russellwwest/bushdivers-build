import{r as o,j as r,a as e,b as C,F as S,u as W,L as K,d as E}from"./app.944e8d8e.js";import{D as M}from"./DispatchSummary.1ddd02b6.js";import{N as L}from"./NoContent.cc240530.js";import{F as D,L as Q,r as P,T as X}from"./index.es.bbd55343.js";import{A as Z}from"./AircraftCondition.8b13e728.js";import{A as ee}from"./AppLayout.595fb028.js";import"./FlashMessage.f8f9d883.js";import"./date.helpers.37179c42.js";const te=a=>{const[s,i]=o.exports.useState(null),[g,w]=o.exports.useState(null),[b,c]=o.exports.useState(""),[v,d]=o.exports.useState("");async function x(h){if(i(null),c(null),d(h.target.value),h.target.value.length>=3){const u=await C.get(`/api/airport/search/${h.target.value}`);if(u.data.airport){c(`${u.data.airport.identifier} - ${u.data.airport.name}`),a.updateDestinationValue(u.data.airport.identifier),i(null);const m=await C.get(`/api/flights/distance/${a.currentAirport}/${u.data.airport.identifier}`);m.status===200?w(m.data.distance):i("Cannot calculate distance")}else a.updateDestinationValue(""),i("No airport found")}}return r("div",{className:"shadow rounded p-4 mt-2 mr-2 bg-white",children:["Destination (ICAO):",e("div",{className:"w-1/4",children:e("input",{id:"icao",type:"text",className:"form-input form",value:v,onChange:x})}),b&&e("div",{className:"text-sm mt-1",children:b}),g&&r("span",{className:"text-sm",children:["Distance: ",g.toLocaleString(navigator.language),"nm"]}),s&&e("div",{className:"text-sm text-red-500 mt-1",children:s})]})},ae=a=>r("div",{className:"shadow rounded p-4 mt-2 mr-2 bg-white",children:[e("div",{className:"text-xl",children:"Select Fuel"}),a.selectedAircraft&&r("div",{children:[r("div",{children:["Useable Fuel (gal): ",a.selectedAircraft.fleet.fuel_capacity]}),r("div",{children:["Current Fuel (gal):",e("div",{className:"w-1/4",children:e("input",{id:"fuel",type:"text",className:"form-input form",value:a.fuel,onChange:a.handleUpdateFuel})}),a.error&&e("span",{className:"text-sm text-red-500",children:a.error})]})]})]}),re=a=>r(S,{children:[e(D,{icon:P}),r("div",{children:["There are no available ",a.content]})]}),ne=a=>r("div",{className:"shadow rounded p-4 mt-2 mr-2 bg-white",children:[e("div",{className:"mb-2 text-xl",children:"Select Cargo"}),e("div",{className:"my-2",children:r("label",{htmlFor:"deadHead",className:"inline-flex items-center",children:[e("input",{id:"deadHead",checked:a.deadHead,onChange:a.handleDeadHead,type:"checkbox",className:"form-checkbox rounded border-gray-300 text-orange-500 shadow-sm focus:border-orange-300 focus:ring focus:ring-offset-0 focus:ring-orange-200 focus:ring-opacity-50"}),e("span",{className:"text-gray-700 ml-2",children:"Deadhead - Run empty"})]})}),a.cargo.length===0?e(L,{content:e(re,{content:"Cargo"})}):!a.deadHead&&e("div",{className:"overflow-x-auto",children:r("table",{className:"table table-auto table-condensed",children:[e("thead",{children:r("tr",{children:[e("td",{}),e("th",{children:"Split"}),e("th",{children:"Current"}),e("th",{children:"Arrival"}),e("th",{children:"Distance"}),e("th",{children:"Heading"}),e("th",{children:"Type"}),e("th",{children:"Cargo"})]})}),e("tbody",{children:a.cargo.map(s=>r("tr",{className:a.selectedCargo.some(i=>i.id===s.id)?"bg-orange-200 hover:bg-orange-100":"",children:[e("td",{children:e("input",{id:"sel",checked:a.selectedCargo.some(i=>i.id===s.id),onChange:()=>a.handleCargoSelect(s),type:"checkbox",className:"form-checkbox rounded border-gray-300 text-orange-500 shadow-sm focus:border-orange-300 focus:ring focus:ring-offset-0 focus:ring-orange-200 focus:ring-opacity-50"})}),e("td",{children:e("button",{className:"btn btn-secondary btn-small",onClick:()=>a.splitCargo(s),children:"Split"})}),e("td",{children:s.current_airport_id}),r("td",{children:[s.contract.arr_airport_id," ",s.contract.arr_airport.longest_runway_surface==="W"&&e("span",{className:"material-icons md-18",children:"anchor"})]}),r("td",{children:[s.contract.distance.toLocaleString(navigator.language)," nm"]}),e("td",{children:r("div",{className:"flex items-center",children:[e("div",{className:"w-1/2",children:e("span",{className:"mr-2",children:s.contract.heading})}),e("div",{className:"w-1/2 flex",children:e("span",{style:{transform:`rotate(${s.contract.heading}deg)`},children:e(D,{icon:Q,className:"text-gray-800"})})})]})}),e("td",{children:s.cargo_type_id===1?"Cargo":"Passenger"}),e("td",{children:s.cargo_type_id===1?r("div",{children:[r("span",{children:[s.cargo_qty.toLocaleString(navigator.language)," lbs"]})," ",e("span",{className:"text-xs",children:s.cargo})]}):r("div",{children:[e("span",{children:s.cargo_qty})," ",e("span",{className:"text-xs",children:s.cargo})]})})]},s.id))})]})})]}),ie=a=>r(S,{children:[e(D,{icon:P}),r("div",{children:["There are no available ",a.content]})]}),se=a=>{const{auth:s}=W().props;return e("div",{className:"shadow rounded p-4 mt-2 mr-2 bg-white",children:a.aircraft.length===0?e(L,{content:e(ie,{content:"Aircraft"})}):r("div",{children:[e("div",{className:"mb-2 text-xl",children:"Select Aircraft"}),r("table",{className:"table table-auto table-condensed",children:[e("thead",{children:r("tr",{children:[e("th",{children:"Registration"}),e("th",{children:"Type"}),e("th",{children:"Current Fuel"}),e("th",{children:"Condition"})]})}),e("tbody",{className:"cursor-pointer",children:a.aircraft.map(i=>r("tr",{onClick:()=>a.handleAircraftSelect(i),className:a.selectedAircraft.registration===i.registration?"bg-orange-200 hover:bg-orange-100 cursor-pointer":"cursor-pointer",children:[e("td",{children:r(X,{content:`Hub: ${i.hub_id}`,direction:"right",children:[i.hub_id&&e(K,{href:`/aircraft/${i.id}`,children:i.registration}),i.rental_airport_id&&e("span",{children:i.registration}),i.owner_id===s.user.id?e("span",{className:"bg-orange-500 text-white rounded ml-2 px-2",children:"Private"}):e(S,{}),i.rental_airport_id&&e("span",{className:"bg-orange-500 text-white rounded ml-2 px-2",children:"Rental"}),i.maintenance_status&&e("span",{className:"ml-2 text-orange-500",children:e("i",{className:"material-icons md-18",children:"engineering"})})]})}),r("td",{children:[i.fleet.manufacturer," ",i.fleet.name," (",i.fleet.type,")"]}),e("td",{children:i.fuel_onboard.toLocaleString(navigator.language)}),e("td",{children:e(Z,{aircraftCondition:i.total_condition})})]},i.id))})]})]})})},ce=({cargo:a,aircraft:s})=>{const{auth:i}=W().props,g=170,w=5.99,b=6.79,[c,v]=o.exports.useState(""),[d,x]=o.exports.useState([]),[h,u]=o.exports.useState(0),[m,I]=o.exports.useState(""),[A,j]=o.exports.useState(0),[f,R]=o.exports.useState(0),[_,U]=o.exports.useState(0),[V,F]=o.exports.useState(null),[q,p]=o.exports.useState(null),[y,N]=o.exports.useState(!1);function z(){c.maintenance_status||N(!y)}function Y(t){p(null),v(s.find(n=>n.registration===t.registration)),u(t.fuel_onboard),t.maintenance_status||t.total_condition<=25?(window.alert("This aircraft is in need of maintenance, and therefore cannot be used for commercial purposes - please head to nearest size 4+ airport or hub for repairs."),N(!0)):N(!1),k(t,t.fuel_onboard)}async function O(t){console.log(t),p(null),d.find(n=>n.id===t.id)?(await x(d.filter(n=>n.id!==t.id)),H("subtract",t),t.cargo_type_id===2&&$("subtract",t)):(await x(n=>n.concat(t)),H("add",t),t.cargo_type_id===2&&$("add",t))}async function B(t){if(d.length>0){window.alert("please un-select any cargo before splitting!");return}if(t.cargo_type_id===2&&t.cargo_qty<=1){window.alert("You cannot split a passenger in half!");return}const n=window.prompt("Enter quantity to split (this will create a new cargo entry with that amount)");if(n)if(n<t.cargo_qty){const l={id:t.id,qty:n};(await C.post("/api/cargo/split",l)).status===201?E.Inertia.reload({only:["cargo"]}):window.alert("Issue splitting cargo")}else window.alert(`New cargo amount must be less than the total cargo: ${t.cargo_qty}`);else window.alert("Cargo split has been cancelled")}function k(t,n){const l=t.fleet.fuel_type===1?n*w:n*b;j(l)}function $(t,n){let l=0;t==="subtract"?l=_-n.cargo_qty:t==="add"&&(l=_+n.cargo_qty),U(l)}function H(t,n){let l=0;t==="subtract"?n.cargo_type_id===1?l=f-n.cargo_qty:l=f-n.cargo_qty*g:t==="add"&&(n.cargo_type_id===1?l=f+n.cargo_qty:l=f+n.cargo_qty*g),R(l)}function G(t){p(null),F(null);const n=t.target.value;if(n>c.fleet.fuel_capacity){F("Cannot specify more than the aircraft fuel capacity"),u(c.fleet.fuel_capacity);return}u(n),k(c,n)}function T(){const t=[];y||d.forEach(l=>{t.push(l.id)});const n={aircraft:c.registration,destination:m,fuel:h,cargo:t,is_empty:y};E.Inertia.post("/dispatch",n)}function J(){if(p(null),y&&c&&h>0&&m){T();return}if(d.length>0&&c&&h>0&&m){if(_>c.fleet.pax_capacity||f>c.fleet.cargo_capacity||g+A+f>c.fleet.mtow-c.fleet.zfw){p("You are overweight!");return}T()}else p("Please make sure you have selected an aircraft, cargo, and fuel")}return r("div",{className:"p-4",children:[e("h1",{children:`Dispatch - ${i.user.current_airport_id}`}),r("div",{className:"flex flex-col md:flex-row justify-between mt-4",children:[r("div",{className:"md:w-1/2",children:[e(se,{aircraft:s,selectedAircraft:c,handleAircraftSelect:Y}),e(ne,{cargo:a,selectedCargo:d,handleCargoSelect:O,splitCargo:B,deadHead:y,handleDeadHead:z}),e(te,{currentAirport:i.user.current_airport_id,updateDestinationValue:I}),e(ae,{selectedAircraft:c,fuel:h,handleUpdateFuel:G,error:V})]}),e("div",{className:"md:w-1/2 mt-2",children:r("div",{className:"shadow rounded p-4 md:ml-2 bg-white",children:[e(M,{selectedAircraft:c,selectedCargo:d,personWeight:g,cargoWeight:f,fuelWeight:A,passengerCount:_,destination:m,fuel:h,deadHead:y}),r("div",{className:"mt-2 text-right",children:[e("button",{onClick:()=>J(),className:"btn btn-secondary",children:"File Dispatch"}),e("br",{}),q&&e("div",{className:"text-red-500 text-xs",children:q})]})]})})]})]})};ce.layout=a=>e(ee,{children:a,title:"Dispatch",heading:"Flight Dispatch"});export{ce as default};

import{r as s,a as e,F as g,j as n,d as D,u as H,b as Y}from"./app.944e8d8e.js";import{T as o,F as u,E as O,w as R,I as q,J as Q,K as U,L as z,M as V,s as B,H as G}from"./index.es.bbd55343.js";import{d as J}from"./date.helpers.37179c42.js";import{m as v}from"./maplibre-gl.11b67a0a.js";import{p as X,f as A}from"./general.helpers.0a3fe5e5.js";import{A as Z,t as K}from"./AppLayout.595fb028.js";import"./FlashMessage.f8f9d883.js";const W="pk.eyJ1IjoicnVzc2VsbHd3ZXN0IiwiYSI6ImNrc29vZm5paDEweGIzMnA3MXAzYTFuMDQifQ.7veU-ARmzYClHDFsVQvT5g",ee=r=>{const p=s.exports.useRef(null),i=s.exports.useRef(null),c=s.exports.useRef(null),m=s.exports.useRef(null),[f,h]=s.exports.useState(!1);s.exports.useEffect(()=>{i.current||(i.current=new v.Map({container:p.current,style:X(r.mapStyle),center:[143.2307,-6.36188],zoom:9,accessToken:W}))}),s.exports.useEffect(()=>{if(r.departure){f&&(i.current.removeLayer("route"),i.current.removeSource("route"),h(!1)),c.current!==null&&c.current.remove();const a=[r.departure.lon,r.departure.lat];x(a)}},[r.departure]),s.exports.useEffect(()=>{if(r.destination){let a=[],l=[];if(f&&(i.current.removeLayer("route"),i.current.removeSource("route"),h(!1)),r.destination!==null&&(a=[r.departure.lon,r.departure.lat],l=[r.destination.lon,r.destination.lat],i.current.isStyleLoaded())){i.current.addSource("route",{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[a,l]}}}),i.current.addLayer({id:"route",type:"line",source:"route",paint:{"line-color":"#F97316","line-width":2}}),y(l),h(!0);const d=[a,l];i.current.fitBounds(d,{padding:{top:70,bottom:70,right:70,left:500}})}}},[r.destination]);const y=a=>{c.current!==null&&c.current.remove();const l=new v.Popup({offset:25}).setText(`${r.destination.identifier} - ${r.destination.name}`),d=new v.Marker({color:"#F97316"}).setLngLat(a).setPopup(l).addTo(i.current);c.current=d},x=a=>{m.current!==null&&m.current.remove();const l=new v.Popup({offset:25}).setText(`${r.departure.identifier} - ${r.departure.name}`),d=new v.Marker({color:"#059669"}).setLngLat(a).setPopup(l).addTo(i.current);m.current=d,i.current.setCenter(a)};return e(g,{children:e("div",{ref:p,className:"map-container-"+r.size})})},te=({departureIcao:r,hideSection:p})=>{const[i,c]=s.exports.useState(null),[m,f]=s.exports.useState(r),[h,y]=s.exports.useState(""),x=d=>{f(d.target.value)},a=d=>{y(d.target.value)},l=async()=>{m&&h?(await D.Inertia.post("/contracts/custom",{departure:m,arrival:h}),p()):c("Please enter a departure and arrival ICAO")};return n("div",{className:"flex items-end",children:[i&&e("div",{className:"text-sm text-red-500 mt-1",children:i}),n("div",{className:"inline-block mx-2",children:[e("label",{htmlFor:"icao",children:e("span",{className:"text-gray-700",children:"Departure Airport (ICAO)"})}),e("input",{id:"icao",type:"text",className:"form-input form",value:m,onChange:x})]}),n("div",{className:"inline-block mx-2",children:[e("label",{htmlFor:"icao",children:e("span",{className:"text-gray-700",children:"Arrival Airport (ICAO)"})}),e("input",{id:"icao",type:"text",className:"form-input form",value:h,onChange:a})]}),e("div",{className:"inline-block mx-2",children:e("button",{onClick:()=>l(),className:"btn btn-secondary",children:"Create"})})]})},re=({searchedContracts:r,airport:p})=>{const{auth:i}=H().props,[c,m]=s.exports.useState(r),[f,h]=s.exports.useState(""),[y,x]=s.exports.useState("Contracts"),[a,l]=s.exports.useState({searchIcao:i.user.current_airport_id,flightLength:"short",aircraftSize:"small"}),[d,I]=s.exports.useState({}),[L,k]=s.exports.useState(null),[F,b]=s.exports.useState(!1),[j,M]=s.exports.useState(!1);s.exports.useEffect(()=>{r&&p?(x(`Contracts - ${p.name} (${p.identifier})`),h(p),m(r)):x("Contracts")},[r]);function N(t){const C=t.target.id,w=t.target.value;l(S=>({...S,[C]:w}))}const _=async()=>{k(null),I(""),b(!1),a.searchIcao.length>0?(D.Inertia.post("/contracts",{icao:a.searchIcao,flightLength:a.flightLength,aircraftSize:a.aircraftSize}),M(!0)):k("Please enter an ICAO")},T=t=>{I(t)},P=async t=>{const C={contract:t,icao:a.searchIcao},w=Y.post("/api/contracts/bid",C);await K.promise(w,{loading:"...Bidding on contract",success:"Contract won!",error:"Issue processing bid"},{position:"top-right"});const S=c.filter($=>$.id!==t.id);m(S)},E=()=>{b(!F)};return n("div",{className:"relative",children:[e(ee,{departure:f,destination:d.destination,size:"full",mapStyle:i.user.map_style}),n("div",{className:"absolute z-30 top-4 left-4 py-2 px-4 bg-white w-1/2 md:w-1/3 opacity-90 shadow rounded",children:[n("div",{className:"flex flex-col md:flex-row justify-start items-baseline space-x-1",children:[e("input",{id:"searchIcao",type:"text",placeholder:"search ICAO",className:"form-input form md:w-1/3",value:a.searchIcao,onChange:N}),e("div",{children:n("select",{id:"flightLength",value:a.flightLength,onChange:N,className:"border border-gray-300 text-gray-900 text-sm rounded focus:ring-orange-500 focus:border-orange-500 block w-full p-2.5",children:[e("option",{value:"short",children:"< 60nm"}),e("option",{value:"medium",children:"60-150nm"}),e("option",{value:"long",children:"> 150nm"})]})}),e("div",{children:n("select",{id:"aircraftSize",value:a.aircraftSize,onChange:N,className:"border border-gray-300 text-gray-900 text-sm rounded focus:ring-orange-500 focus:border-orange-500 block w-full p-2.5",children:[e("option",{value:"small",children:"Small Aircraft"}),e("option",{value:"medium",children:"Medium Aircraft"}),e("option",{value:"large",children:"Large Aircraft"})]})})]}),n("div",{className:"flex flex-col md:flex-row justify-end items-baseline mt-2",children:[e("div",{children:e("button",{onClick:()=>_(),className:"btn btn-secondary",children:"Find"})}),e("div",{children:e(o,{direction:"top",content:"Create custom contract",children:e("button",{onClick:()=>E(),className:"btn btn-secondary ml-2",children:"Custom"})})})]}),L&&e("span",{className:"text-sm text-red-500",children:L})]}),F&&e("div",{className:"absolute z-30 top-4 left-1/3 ml-8 py-2 px-4 bg-white w-1/2 md:w-1/3 opacity-90 shadow rounded",children:e(te,{departureIcao:a.searchIcao,hideSection:()=>b(!1)})}),j&&c&&e("div",{className:"absolute z-30 top-32 left-4 bottom-4 bg-white w-1/2 md:w-1/3 opacity-90 shadow rounded h-auto overflow-y-auto mb-2",children:c&&c.map(t=>n("div",{onClick:()=>T(t),className:`${t.id===d.id?"bg-orange-200 hover:bg-orange-100":""} border-t-2 text-sm cursor-pointer z-40`,children:[n("div",{className:"px-4 py-2 flex justify-between items-center",children:[e(o,{direction:"right",content:"Expiry date",children:e("div",{className:"text-xs text-gray-700",children:J(t.expires_at).format("DD/MM/YYYY HH:mm")})}),e(o,{direction:"bottom",content:"Destination",children:n("div",{className:"text-sm text-gray-800 font-bold",children:[t.destination.identifier," ",t.destination.longest_runway_surface==="W"?e(u,{icon:O}):e(g,{})]})}),e(o,{direction:"left",content:"Accept contract",children:e("button",{onClick:()=>P(t),className:"btn btn-secondary btn-small",children:e(u,{icon:R})})})]}),e("div",{className:"px-4 py-2 flex justify-between",children:n("div",{className:"flex items-center space-x-4",children:[e(o,{direction:"bottom",content:"Total cargo",children:n("div",{className:"mx-1 flex items-center space-x-1",children:[e(u,{icon:q}),n("span",{children:[t.cargo_type===1?e(g,{children:A(t.cargo_qty)}):e(g,{children:"0"})," lbs"]})]})}),e(o,{direction:"bottom",content:"Total pax",children:n("div",{className:"mx-1 flex items-center space-x-1",children:[e(u,{icon:Q}),e("span",{children:t.cargo_type===2?e(g,{children:t.cargo_qty}):e(g,{children:"0"})})]})}),e(o,{direction:"bottom",content:"Distance",children:n("div",{className:"mx-1 flex items-center space-x-1",children:[e(u,{icon:U}),n("span",{children:[t.distance," nm"]})]})}),e(o,{direction:"bottom",content:"Heading",children:e("div",{className:"mx-1 flex items-center space-x-1",children:e("span",{style:{transform:`rotate(${t.heading}deg)`},children:e(u,{icon:z,className:"text-gray-700"})})})}),e(o,{direction:"left",content:"Contract value",children:n("div",{className:"mx-1 flex items-center space-x-1",children:[e(u,{icon:V}),e("span",{children:A(t.contract_value)})]})})]})}),e("div",{className:"flex justify-between px-4 py-2",children:e("div",{className:"mt-1 text-xs",children:e("div",{className:"flex justify-between items-center cursor-pointer",children:n("div",{className:"flex justify-between items-center text-sm",children:[n("div",{className:"flex items-center space-x-1 mr-4",children:[e(o,{direction:"top",content:"Origin",children:n("div",{className:"mr-1 flex items-center space-x-1",children:[e(u,{icon:B}),e("span",{children:t.departure})]})}),e(o,{direction:"top",content:"Destination",children:n("div",{className:"mr-2 flex items-center space-x-1",children:[e(u,{icon:G}),e("span",{children:t.destination.identifier})]})})]}),e(o,{direction:"top",content:"Cargo",children:n("div",{className:"mr-2 flex items-center space-x-1",children:[n("div",{className:"mr-1",children:[A(t.cargo_qty)," ",t.cargo_type===1?"lbs":""]}),e("div",{className:"mr-2",children:t.cargo})]})}),e(o,{direction:"left",content:"Heading",children:e("div",{className:"flex items-center space-x-1",children:e("span",{style:{transform:`rotate(${t.heading}deg)`},children:e(u,{icon:z,className:"text-gray-700"})})})})]})})})})]},t.id))})]})};re.layout=r=>e(Z,{children:r,title:"Find a Contract",heading:"Find a Contract"});export{re as default};

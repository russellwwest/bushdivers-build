import{r as a,a as i,F as b,b as v,u as _,j as w}from"./app.944e8d8e.js";import{m as p}from"./maplibre-gl.11b67a0a.js";import{p as x}from"./general.helpers.0a3fe5e5.js";import{A as F}from"./AppLayout.595fb028.js";import{S as k}from"./StatBlock.8f20e18b.js";import"./FlashMessage.f8f9d883.js";import"./date.helpers.37179c42.js";import"./index.es.bbd55343.js";function y(e,n){const s=a.exports.useRef();a.exports.useEffect(()=>{s.current=e},[e]),a.exports.useEffect(()=>{function o(){s.current()}if(n!==null){const r=setInterval(o,n);return()=>clearInterval(r)}})}const L="pk.eyJ1IjoicnVzc2VsbHd3ZXN0IiwiYSI6ImNrc29vZm5paDEweGIzMnA3MXAzYTFuMDQifQ.7veU-ARmzYClHDFsVQvT5g",M=({size:e,updateFlightCount:n,mapStyle:s})=>{const o=a.exports.useRef(null),r=a.exports.useRef(null),l=a.exports.useRef([]);y(async()=>{await m()},3e4);const m=async()=>{let u=[];l.current.length>0&&(await l.current.forEach(t=>t.remove()),l.current=[]);const d=await v.get("/api/liveflights");d.status===200&&(u=d.data.flights),n(u.length),u.forEach(t=>{const h=[t.current_lon,t.current_lat],g=new p.Popup({offset:25}).setHTML(`
            <b>Pilot:</b> ${t.pilot.pilot_id} ${t.pilot.private_name}<br/>
            <b>Route:</b> ${t.departure_airport_id} - ${t.destination_airport_id}<br/>
            <b>Aircraft:</b><br/>
            ${t.is_rental?t.rental.fleet.manufacturer:t.aircraft.fleet.manufacturer}
            ${t.is_rental?t.rental.fleet.name:t.aircraft.fleet.name}
            <br/>
            ${t.is_rental?t.rental.registration:t.aircraft.registration}<br/>
            <b>Altitude:</b> ${t.current_altitude} ft<br/>
            <b>Ground Speed:</b> ${t.current_indicated_speed} kts<br/>
            <b>Heading:</b> ${t.current_heading}&#176;<br/>
         `),c=document.createElement("img");c.className="marker",c.width=30,c.height=30,c.src="https://res.cloudinary.com/dji0yvkef/image/upload/v1631525263/BDVA/icon_c208_orangekFus_whiteWings_revnmm.png";const f=new p.Marker(c,{rotation:t.current_heading}).setLngLat(h).setPopup(g).addTo(r.current);l.current.push(f)})};return a.exports.useEffect(async()=>{r.current||(r.current=new p.Map({container:o.current,style:x(s),center:[165.272614,29.5309],zoom:2,accessToken:L}),await r.current.on("load",function(){m()}))},[]),i(b,{children:i("div",{ref:o,className:"map-container-"+e})})},$=()=>{const{auth:e}=_().props,[n,s]=a.exports.useState(0);return w("div",{className:"relative",children:[i(M,{size:"full",updateFlightCount:r=>{s(r)},mapStyle:e.user.map_style}),i("div",{className:"absolute z-30 bg-white w-1/2 md:w-1/6 opacity-80 h-auto top-4 left-4 p-4 rounded shadow",children:i(k,{width:"1/2",data:n,text:"Current Flights"})})]})};$.layout=e=>i(F,{children:e,title:"Live Flights",heading:"Live Flights"});export{$ as default};
